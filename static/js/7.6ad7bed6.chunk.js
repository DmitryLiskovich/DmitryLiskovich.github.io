(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{197:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=197},198:function(e,t,a){},199:function(e,t,a){},200:function(e,t,a){},202:function(e,t){},203:function(e,t){},204:function(e,t,a){},205:function(e,t,a){},210:function(e,t,a){"use strict";a.r(t);var n=a(43),c=a(52),r=a.n(c),l=a(53),i=a(37),o=a(9),s=a(0),u=a.n(s),m=a(196),f=a.n(m),d=a(54),p=a.n(d);a(198),a(199);var g=function(e){var t=Object(s.useState)([]),a=Object(o.a)(t,2),c=a[0],r=a[1],l=Object(s.useState)({state:!1,name:null}),i=Object(o.a)(l,2),m=i[0],f=i[1],d=e.selectedUser,p=e.socket,g="",v=Object(s.useRef)(null),E=Object(s.useRef)(null);return Object(s.useEffect)(function(){v.current&&(v.current.scrollTop=v.current.scrollHeight)},[c]),Object(s.useEffect)(function(){p.on("message-from",function(e){"typing"===e.type?f({state:!0,name:e.message}):"connect"===e.type?r(function(t){return[].concat(Object(n.a)(t),[{message:e.message,id:null}])}):"typing-end"===e.type?f({state:!1,name:null}):r(function(t){return[].concat(Object(n.a)(t),[{message:e.input,id:e.id}])})})},[]),u.a.createElement("div",{className:"TextChat"},u.a.createElement("div",{ref:v,className:"messages-wrap"},c.map(function(e,t){var a="You"===e.id;return e.id?u.a.createElement("div",{key:t,className:"message ".concat(a&&"my_message")},u.a.createElement("p",null,e.message),u.a.createElement("p",{className:"id"},e.id)):u.a.createElement("div",{key:t,className:"message-connect"},u.a.createElement("p",null,e.message))})),u.a.createElement("div",{className:"input"},u.a.createElement("form",{onSubmit:function(e){e.preventDefault(),p.emit("message-from",{input:g,id:d}),r([].concat(Object(n.a)(c),[{message:g,id:"You"}])),e.target.message.value="",E.current.focus()}},u.a.createElement("input",{ref:E,name:"message",placeholder:m.state?m.name:"message",onInput:function(){return p.emit("typing...")},onChange:function(e){g=e.target.value},type:"text"}),u.a.createElement("button",{type:"submit"},"Send"))))};a(200);function v(e){var t=e.message;return u.a.createElement("div",{className:"modal-wrap"},u.a.createElement("div",{className:"modal"},u.a.createElement("h2",null,t)))}var E,b=a(201),j=a.n(b);a(204);function h(e){var t=Object(s.useState)([]),a=Object(o.a)(t,2),c=a[0],r=a[1],l=Object(o.a)(e.drawing,2),m=l[0],f=l[1],d=Object(s.useState)(),p=Object(o.a)(d,2),g=p[0],v=p[1],h=Object(s.useRef)(null),O=Object(s.useRef)(null);Object(s.useEffect)(function(){function e(e){E&&e.layerX>0&&E.add(e.layerX,e.layerY)}function t(){E&&(E.simplify(),E.selected=!1),h.current.removeEventListener("mousemove",e),h.current.removeEventListener("mouseup",t)}j.a.setup(h.current),h.current.addEventListener("mousedown",function(a){E&&(E.selected=!1);2===a.button&&E&&(c.forEach(function(e){return e.remove()}),r([]));E=new b.Path({strokeColor:"#152238",selected:!0}),r(function(e){return[].concat(Object(n.a)(e),[E])}),["mousemove","touchmove"].forEach(function(t){return h.current.addEventListener(t,e)}),h.current.addEventListener("mouseup",t)}),f(Object(i.a)({},m,{drawing:!1})),O.current.value=1},[]),E&&(E.strokeWidth=g);return u.a.createElement("div",{className:"chat-drawing ".concat(m.drawing?"":"hidden")},u.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return f(Object(i.a)({},m,{drawing:!1}))}}),u.a.createElement("canvas",{id:"draw",ref:h}),u.a.createElement("div",{className:"draw-tools"},u.a.createElement("div",null,u.a.createElement("h2",null,"Layers"),u.a.createElement("ul",{onClick:function(e){if("LI"===e.target.tagName)c.forEach(function(e){return e.selected=!1}),c[+e.target.getAttribute("data-index")].selected=!0;else if("I"===e.target.tagName){c[+e.target.parentElement.getAttribute("data-index")].remove();var t=c;t.splice(+e.target.parentElement.getAttribute("data-index"),1),console.log(t),r(function(e){return Object(n.a)(t)})}}},c.map(function(e,t){return u.a.createElement("li",{"data-index":t,key:t},"Line - ",t," ",u.a.createElement("i",{className:"fas fa-trash-alt"}))})),u.a.createElement("div",{className:"tools"},g,u.a.createElement("input",{onInput:function(e){return v(e.target.value)},ref:O,type:"range",min:"1",max:"100"})))))}a(205);function O(e){var t=e.state,a=e.streams,n=e.myVideoStream;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"video-chat"},u.a.createElement("div",{className:"video-chat__wrap"},u.a.createElement("div",{className:"video-chat__wrap_my"},u.a.createElement("video",{className:"my",ref:n,autoPlay:!0})),u.a.createElement("div",{className:"video-chat__wrap_remote"},a.map(function(e,t){return e.active?u.a.createElement("video",{className:"video",width:"auto",autoPlay:!0,key:t,ref:function(t){return t?t.srcObject=e:""}}):""})),u.a.createElement("div",{className:"button-section"},u.a.createElement("div",{onClick:function(){return t.peercall?t.peercall.close():t.peer.close()},className:"reject calling"},u.a.createElement("i",{className:"fas fa-phone-slash"})),u.a.createElement("i",{className:"fas fa-microphone"}),u.a.createElement("i",{className:"fas fa-volume-up"})))))}a.d(t,"default",function(){return S});var N,w,y,k={config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}};function S(e){var t=Object(s.useState)({drawing:!0,catchIt:!1,calling:!1,chatState:!1,peer:new f.a(k),localStream:null,peercall:null,rejected:!1}),a=Object(o.a)(t,2),c=a[0],m=a[1],d=Object(s.useState)([]),p=Object(o.a)(d,2),E=p[0],b=p[1],j=Object(s.useState)(),S=Object(o.a)(j,2),U=S[0],I=(S[1],Object(s.useRef)(null)),C=e.user.name,_=e.socket,x=Object(s.useState)({}),L=Object(o.a)(x,2),M=L[0],T=L[1];function A(e){w=e.currentTarget.parentElement.parentElement.getAttribute("data-number");var t=c.peer.connect(w);t.on("open",function(){t.on("data",function(e){if("rejected"!==e){if(!navigator.getUserMedia)return y="You don't have web camera or you have http connection",m(function(e){return Object(i.a)({},e,{rejected:!0})}),void setTimeout(function(){m(function(e){return Object(i.a)({},e,{rejected:!1})})},5e3);navigator.getUserMedia({video:!0,audio:!1},function(e){var t=c.peer.call(w,e);t.on("stream",function(t){return R(t,e)}),t.on("close",function(t){e.getTracks().forEach(function(e){return e.stop()}),m(function(e){return Object(i.a)({},e,{calling:!1})})}),m(function(e){return Object(i.a)({},e,{calling:!0,peercall:t})})},D)}else"rejected"===e&&(y="Your call has been rejected",m(function(e){return Object(i.a)({},e,{rejected:!0})}),setTimeout(function(){m(function(e){return Object(i.a)({},e,{rejected:!1})})},5e3))}),t.send("request")})}function R(e,t){t.getAudioTracks().enabled=!1,I.current.srcObject=t,e!==N&&(b(function(t){return[].concat(Object(n.a)(t),[e])}),N=e)}function Y(){c.peercall.send("rejected"),m(function(e){return Object(i.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function F(){c.peercall.send("accepted"),m(function(e){return Object(i.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function D(e){alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e))}return Object(s.useEffect)(function(){c.peer.on("open",function(e){_.send(e)}),c.peer.on("connection",function(e){e.on("data",function(t){m(function(t){return Object(i.a)({},t,{catchIt:!0,peercall:e})})}),m(function(t){return Object(i.a)({},t,{peercall:e})})}),_.on("message",function(){var e=Object(l.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:delete t[C],T(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),c.peer.on("call",function(e){navigator.getUserMedia?navigator.getUserMedia({video:!0,audio:!1},function(t){e.answer(t),w=e.peer,e.on("close",function(e){t.getTracks().forEach(function(e){return e.stop()}),console.log(E),0===E.length&&m(function(e){return Object(i.a)({},e,{calling:!1})})}),e.on("stream",function(e){return R(e,t)}),m(function(t){return Object(i.a)({},t,{catchIt:!1,calling:!0,peercall:e})})},D):e.close()})},[]),Object(s.useEffect)(function(){m(U?function(e){return Object(i.a)({},e,{chatState:!0})}:function(e){return Object(i.a)({},e,{chatState:!1})})},[U]),u.a.createElement(u.a.Fragment,null,u.a.createElement(h,{drawing:[c,m]}),u.a.createElement("div",{className:"App"},c.rejected&&u.a.createElement(v,{message:y}),u.a.createElement("div",{className:"users-list ".concat(c.calling||c.chatState?"hidden":"")},u.a.createElement("ul",null,u.a.createElement("li",{className:"header"},u.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return m(Object(i.a)({},c,{drawing:!0}))}}),u.a.createElement("h1",null,"Users List"),u.a.createElement("i",{className:"far fa-comments chat-change",onClick:function(){return m(Object(i.a)({},c,{chatState:!0}))}})),Object.keys(M).map(function(e,t){return u.a.createElement("li",{"data-name":e,className:"".concat(U&&U[e]&&"active"),"data-number":M[e],key:t},u.a.createElement("div",{className:"user-name"},e.slice(0,2)),u.a.createElement("p",null,e),u.a.createElement("div",{className:"button"},u.a.createElement("div",{onClick:c.catchIt?F:A,className:"calling ".concat(c.catchIt&&c.peercall.peer===M[e]?"pulse-button":"")},u.a.createElement("i",{className:"fas fa-phone"})),c.catchIt&&c.peercall.peer===M[e]&&u.a.createElement("div",{onClick:Y,className:"reject calling"},u.a.createElement("i",{className:"fas fa-phone-slash"}))))}))),c.calling&&u.a.createElement("div",{className:"video-chat_from-chat ".concat(!c.calling&&"hidden")},u.a.createElement(O,{myVideoStream:I,streams:E,state:c})),!c.calling&&u.a.createElement(u.a.Fragment,null,u.a.createElement("i",{onClick:function(){return m(function(e){return Object(i.a)({},e,{chatState:!1})})},className:"fas fa-times close-button ".concat(c.chatState?"":"hidden")}),u.a.createElement("div",{className:"text-chat ".concat(!c.chatState&&"hidden")},u.a.createElement(g,{selectedUser:C,socket:_})))))}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,setInterval(function(){p.a.get("https://rocky-reef-68087.herokuapp.com/email")},3e5)}}]);
//# sourceMappingURL=7.6ad7bed6.chunk.js.map