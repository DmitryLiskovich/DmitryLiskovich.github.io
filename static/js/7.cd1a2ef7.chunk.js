(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{163:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=163},164:function(e,t,a){},165:function(e,t,a){},166:function(e,t,a){},168:function(e,t){},169:function(e,t){},170:function(e,t,a){},171:function(e,t,a){},201:function(e,t){},204:function(e,t,a){},205:function(e,t,a){},210:function(e,t,a){"use strict";a.r(t);var n=a(37),c=a(9),r=a(0),l=a.n(r),o=a(42),s=a(52),i=a.n(s),u=a(53),m=a(162),f=a.n(m),d=a(54),p=a.n(d);a(164),a(165);var g=function(e){var t=Object(r.useState)([]),a=Object(c.a)(t,2),n=a[0],s=a[1],i=Object(r.useState)({state:!1,name:null}),u=Object(c.a)(i,2),m=u[0],f=u[1],d=e.selectedUser,p=e.socket,g="",v=Object(r.useRef)(null),E=Object(r.useRef)(null);return Object(r.useEffect)(function(){v.current&&(v.current.scrollTop=v.current.scrollHeight)},[n]),Object(r.useEffect)(function(){p.on("message-from",function(e){"typing"===e.type?f({state:!0,name:e.message}):"connect"===e.type?s(function(t){return[].concat(Object(o.a)(t),[{message:e.message,id:null}])}):"typing-end"===e.type?f({state:!1,name:null}):s(function(t){return[].concat(Object(o.a)(t),[{message:e.input,id:e.id}])})})},[]),l.a.createElement("div",{className:"TextChat"},l.a.createElement("div",{ref:v,className:"messages-wrap"},n.map(function(e,t){var a="You"===e.id;return e.id?l.a.createElement("div",{key:t,className:"message ".concat(a&&"my_message")},l.a.createElement("p",null,e.message),l.a.createElement("p",{className:"id"},e.id)):l.a.createElement("div",{key:t,className:"message-connect"},l.a.createElement("p",null,e.message))})),l.a.createElement("div",{className:"input"},l.a.createElement("form",{onSubmit:function(e){e.preventDefault(),p.emit("message-from",{input:g,id:d}),s([].concat(Object(o.a)(n),[{message:g,id:"You"}])),e.target.message.value="",E.current.focus()}},l.a.createElement("input",{ref:E,name:"message",placeholder:m.state?m.name:"message",onInput:function(){return p.emit("typing...")},onChange:function(e){g=e.target.value},type:"text"}),l.a.createElement("button",{type:"submit"},"Send"))))};a(166);function v(e){var t=e.message;return l.a.createElement("div",{className:"modal-wrap"},l.a.createElement("div",{className:"modal"},l.a.createElement("h2",null,t)))}var E,b=a(167),j=a.n(b);a(170);function h(e){var t=Object(r.useState)([]),a=Object(c.a)(t,2),s=a[0],i=a[1],u=Object(c.a)(e.drawing,2),m=u[0],f=u[1],d=Object(r.useState)(),p=Object(c.a)(d,2),g=p[0],v=p[1],h=Object(r.useRef)(null),O=Object(r.useRef)(null);Object(r.useEffect)(function(){function e(e){E&&e.layerX>0&&E.add(e.layerX,e.layerY)}function t(){E&&(E.simplify(),E.selected=!1),h.current.removeEventListener("mousemove",e),h.current.removeEventListener("mouseup",t)}j.a.setup(h.current),h.current.addEventListener("mousedown",function(a){E&&(E.selected=!1);2===a.button&&E&&(s.forEach(function(e){return e.remove()}),i([]));E=new b.Path({strokeColor:"#152238",selected:!0}),i(function(e){return[].concat(Object(o.a)(e),[E])}),h.current.addEventListener("mousemove",e),h.current.addEventListener("mouseup",t)}),f(Object(n.a)({},m,{drawing:!1})),O.current.value=1},[]),E&&(E.strokeWidth=g);return l.a.createElement("div",{className:"chat-drawing ".concat(m.drawing?"":"hidden")},l.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return f(Object(n.a)({},m,{drawing:!1}))}}),l.a.createElement("canvas",{id:"draw",ref:h}),l.a.createElement("div",{className:"draw-tools"},l.a.createElement("div",null,l.a.createElement("h2",null,"Layers"),l.a.createElement("ul",{onClick:function(e){if("LI"===e.target.tagName)s.forEach(function(e){return e.selected=!1}),s[+e.target.getAttribute("data-index")].selected=!0;else if("I"===e.target.tagName){s[+e.target.parentElement.getAttribute("data-index")].remove();var t=s;t.splice(+e.target.parentElement.getAttribute("data-index"),1),console.log(t),i(function(e){return Object(o.a)(t)})}}},s.map(function(e,t){return l.a.createElement("li",{"data-index":t,key:t},"Line - ",t," ",l.a.createElement("i",{className:"fas fa-trash-alt"}))})),l.a.createElement("div",{className:"tools"},g,l.a.createElement("input",{onInput:function(e){return v(e.target.value)},ref:O,type:"range",min:"1",max:"100"})))))}a(171);function O(e){var t=e.state,a=e.streams,n=e.myVideoStream;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"video-chat"},l.a.createElement("div",{className:"video-chat__wrap"},l.a.createElement("div",{className:"video-chat__wrap_my"},l.a.createElement("video",{className:"my",ref:n,autoPlay:!0})),l.a.createElement("div",{className:"video-chat__wrap_remote"},a.map(function(e,t){return e.active?l.a.createElement("video",{className:"video",width:"auto",autoPlay:!0,key:t,ref:function(t){return t?t.srcObject=e:""}}):""})),l.a.createElement("div",{className:"button-section"},l.a.createElement("div",{onClick:function(){return t.peercall?t.peercall.close():t.peer.close()},className:"reject calling"},l.a.createElement("i",{className:"fas fa-phone-slash"})),l.a.createElement("i",{className:"fas fa-microphone"}),l.a.createElement("i",{className:"fas fa-volume-up"})))))}var N,y,w,k={config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}};function S(e){var t=Object(r.useState)({drawing:!0,catchIt:!1,calling:!1,chatState:!1,peer:new f.a(k),localStream:null,peercall:null,rejected:!1}),a=Object(c.a)(t,2),s=a[0],m=a[1],d=Object(r.useState)([]),p=Object(c.a)(d,2),E=p[0],b=p[1],j=Object(r.useState)(),S=Object(c.a)(j,2),C=S[0],I=(S[1],Object(r.useRef)(null)),U=e.user.name,_=e.socket,x=Object(r.useState)({}),M=Object(c.a)(x,2),L=M[0],T=M[1];function A(e){y=e.currentTarget.parentElement.parentElement.getAttribute("data-number");var t=s.peer.connect(y);t.on("open",function(){t.on("data",function(e){if("rejected"!==e){if(!navigator.getUserMedia)return w="You don't have web camera or you have http connection",m(function(e){return Object(n.a)({},e,{rejected:!0})}),void setTimeout(function(){m(function(e){return Object(n.a)({},e,{rejected:!1})})},5e3);navigator.getUserMedia({video:!0,audio:!1},function(e){var t=s.peer.call(y,e);t.on("stream",function(t){return R(t,e)}),t.on("close",function(t){e.getTracks().forEach(function(e){return e.stop()}),m(function(e){return Object(n.a)({},e,{calling:!1})})}),m(function(e){return Object(n.a)({},e,{calling:!0,peercall:t})})},D)}else"rejected"===e&&(w="Your call has been rejected",m(function(e){return Object(n.a)({},e,{rejected:!0})}),setTimeout(function(){m(function(e){return Object(n.a)({},e,{rejected:!1})})},5e3))}),t.send("request")})}function R(e,t){t.getAudioTracks().enabled=!1,I.current.srcObject=t,e!==N&&(b(function(t){return[].concat(Object(o.a)(t),[e])}),N=e)}function F(){s.peercall.send("rejected"),m(function(e){return Object(n.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function Y(){s.peercall.send("accepted"),m(function(e){return Object(n.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function D(e){alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e))}return Object(r.useEffect)(function(){s.peer.on("open",function(e){_.send(e)}),s.peer.on("connection",function(e){e.on("data",function(t){m(function(t){return Object(n.a)({},t,{catchIt:!0,peercall:e})})}),m(function(t){return Object(n.a)({},t,{peercall:e})})}),_.on("message",function(){var e=Object(u.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:delete t[U],T(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),s.peer.on("call",function(e){navigator.getUserMedia?navigator.getUserMedia({video:!0,audio:!1},function(t){e.answer(t),y=e.peer,e.on("close",function(e){t.getTracks().forEach(function(e){return e.stop()}),console.log(E),0===E.length&&m(function(e){return Object(n.a)({},e,{calling:!1})})}),e.on("stream",function(e){return R(e,t)}),m(function(t){return Object(n.a)({},t,{catchIt:!1,calling:!0,peercall:e})})},D):e.close()})},[]),Object(r.useEffect)(function(){m(C?function(e){return Object(n.a)({},e,{chatState:!0})}:function(e){return Object(n.a)({},e,{chatState:!1})})},[C]),l.a.createElement(l.a.Fragment,null,l.a.createElement(h,{drawing:[s,m]}),l.a.createElement("div",{className:"App"},s.rejected&&l.a.createElement(v,{message:w}),l.a.createElement("div",{className:"users-list ".concat(s.calling||s.chatState?"hidden":"")},l.a.createElement("ul",null,l.a.createElement("li",{className:"header"},l.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return m(Object(n.a)({},s,{drawing:!0}))}}),l.a.createElement("h1",null,"Users List"),l.a.createElement("i",{className:"far fa-comments chat-change",onClick:function(){return m(Object(n.a)({},s,{chatState:!0}))}})),Object.keys(L).map(function(e,t){return l.a.createElement("li",{"data-name":e,className:"".concat(C&&C[e]&&"active"),"data-number":L[e],key:t},l.a.createElement("div",{className:"user-name"},e.slice(0,2)),l.a.createElement("p",null,e),l.a.createElement("div",{className:"button"},l.a.createElement("div",{onClick:s.catchIt?Y:A,className:"calling ".concat(s.catchIt&&s.peercall.peer===L[e]?"pulse-button":"")},l.a.createElement("i",{className:"fas fa-phone"})),s.catchIt&&s.peercall.peer===L[e]&&l.a.createElement("div",{onClick:F,className:"reject calling"},l.a.createElement("i",{className:"fas fa-phone-slash"}))))}))),s.calling&&l.a.createElement("div",{className:"video-chat_from-chat ".concat(!s.calling&&"hidden")},l.a.createElement(O,{myVideoStream:I,streams:E,state:s})),!s.calling&&l.a.createElement(l.a.Fragment,null,l.a.createElement("i",{onClick:function(){return m(function(e){return Object(n.a)({},e,{chatState:!1})})},className:"fas fa-times close-button ".concat(s.chatState?"":"hidden")}),l.a.createElement("div",{className:"text-chat ".concat(!s.chatState&&"hidden")},l.a.createElement(g,{selectedUser:U,socket:_})))))}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,setInterval(function(){p.a.get("https://rocky-reef-68087.herokuapp.com/email")},3e5);var C,I=a(172),U=a.n(I);a(204),a(205);function _(){return l.a.createElement("div",{className:"lds-dual-ring"})}function x(){var e=Object(r.useState)({spinner:!1,loggined:!1,userIsCreated:!1,users:{}}),t=Object(c.a)(e,2),a=t[0],o=t[1];return Object(r.useEffect)(function(){return document.title="Chat",C.on("message",function(e){"err"===e.type?o(function(e){return Object(n.a)({},e,{spinner:!1,loggined:!1,userIsCreated:!0})}):o(function(e){return Object(n.a)({},e,{spinner:!1,loggined:!0})})}),function(){C.close()}},[]),a.loggined?l.a.createElement(S,{socket:C,user:a.users}):l.a.createElement("div",{className:"login-wrap"},l.a.createElement("form",{className:"user-connection",onSubmit:function(e){o(function(t){return Object(n.a)({},t,{spinner:!0,users:{name:e.target.name.value,room:e.target.room.value}})}),e.preventDefault(),C.emit("join",e.target.room.value,e.target.name.value),console.log("object")}},a.spinner&&l.a.createElement(_,null),l.a.createElement("h2",{className:"form-signin-heading"},"Please select room and enter your nickname"),l.a.createElement("select",{type:"",className:"form-control",name:"room",required:!0},l.a.createElement("option",null,"First room"),l.a.createElement("option",null,"Second room")),l.a.createElement("input",{type:"text",className:"form-control",name:"name",placeholder:"USER NAME",required:!0}),a.userIsCreated&&l.a.createElement("div",{className:"alert"},"User already in this room"),l.a.createElement("input",{className:"submitButton",type:"submit",value:"Enter"})))}a.d(t,"default",function(){return x}),C=U.a.connect("https://rocky-reef-68087.herokuapp.com")}}]);
//# sourceMappingURL=7.cd1a2ef7.chunk.js.map