(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{128:function(e,t,a){},194:function(e,t,a){},195:function(e,t,a){},196:function(e,t,a){},197:function(e,t,a){},199:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=199},200:function(e,t,a){},201:function(e,t,a){},202:function(e,t,a){},206:function(e,t,a){"use strict";a.r(t);var n=a(24),r=a(0),l=a.n(r),c=a(96),s=a.n(c),o=a(97),i=(a(194),a(108)),u=a(30);function m(e){var t=e.user,a=e.messages;return l.a.createElement(l.a.Fragment,null,a.map(function(e,a){var n=function(e){var t=new Date(e);return"".concat(t.getDate()," ").concat(["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()+1]," - ").concat(t.getHours(),":").concat(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())}(e.date);return l.a.createElement("div",{className:e.user===t.id?"right":"left",key:a},l.a.createElement("p",{className:"message-text"},e.message),l.a.createElement("p",{className:"date"},n))}))}a(195);function d(){return l.a.createElement("div",{className:"lds-dual-ring"})}var f=a(98),p=a.n(f);a(196);function g(e){var t=e.selectedUser,a=e.setCallStatus,c=(e.call,Object(r.useContext)(u.a)),s=Object(r.useState)([]),o=Object(n.a)(s,2),f=o[0],g=o[1],v=Object(r.useState)(),h=Object(n.a)(v,2),b=h[0],E=h[1],w=Object(r.useState)(!1),j=Object(n.a)(w,2),O=j[0],y=j[1],N=Object(r.useState)({}),S=Object(n.a)(N,2),C=S[0],x=S[1],k=Object(r.useRef)(null),_=Object(r.useRef)(null);return Object(r.useEffect)(function(){return y(!0),p.a.get("http://localhost:8000/users",{withCredentials:!0}).then(function(e){var a=e.data;if(x(a),a.id!==t.id){var n=a.sessions&&a.sessions[t.id]?a.sessions[t.id]:"new";c.emit("join",n,[a.id,t.id]),c.on("message",function(e){g(function(t){return[].concat(Object(i.a)(t),[e])})}),c.on("messages",function(e){g(e)}),y(!1)}else window.location.reload()}),function(){c.emit("leave"),c.removeAllListeners("message"),c.removeAllListeners("messages")}},[t.id]),Object(r.useEffect)(function(){k.current.scrollBy(0,k.current.scrollHeight)},[f]),l.a.createElement("div",{className:"TextChat"},l.a.createElement("div",{className:"chat-controller"},l.a.createElement("h2",null,"Chat with ",t.username.slice(3)),l.a.createElement("div",{className:"buttons"},l.a.createElement("i",{className:"fas fa-user-plus"}),l.a.createElement("i",{onClick:function(){return a({type:"startCall",user:t})},className:"fas fa-phone"}))),l.a.createElement("div",{ref:k,className:"messages-wrap"},l.a.createElement(m,{messages:f,user:C})),l.a.createElement("div",{className:"input"},l.a.createElement("form",{autoComplete:"off",onSubmit:function(e){e.preventDefault(e),E(""),g(function(e){return[].concat(Object(i.a)(e),[{message:b,user:C.id,date:new Date}])}),c.send(b),_.current.focus()}},l.a.createElement("input",{name:"message",ref:_,value:b,placeholder:"Type something...",onChange:function(e){e.persist(),E(e.target.value)},type:"text"}),l.a.createElement("button",{type:"submit"},"Send"))),O&&l.a.createElement(d,null))}a(197);function v(e){var t=e.user,a=e.reject,n=e.accept,r=e.className;return l.a.createElement("div",{className:"modal-frame ".concat(r)},l.a.createElement("h2",null,"Incoming call from ",t),l.a.createElement("div",{className:"modal-controls"},l.a.createElement("i",{onClick:a,className:"fas fa-phone-slash"}),l.a.createElement("i",{onClick:n,className:"fas fa-phone"})))}var h=a(198),b=a.n(h),E=(a(200),{host:"localhost",port:9e3,path:"/lis-chat"});function w(e){var t=e.callNumber,a=e.myNumber,c=e.callStatus,i=e.setCallStatus,u=Object(r.useState)({}),m=Object(n.a)(u,2),d=m[0],f=m[1],p=Object(r.useState)({}),g=Object(n.a)(p,2),h=g[0],w=g[1],j=Object(r.useState)(null),O=Object(n.a)(j,2),y=O[0],N=O[1],S=Object(r.useState)({}),C=Object(n.a)(S,2),x=C[0],k=C[1];function _(){return L.apply(this,arguments)}function L(){return(L=Object(o.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.data,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:a=e.sent,P(h.peer.call(t,a));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function P(e){var t;e.on("stream",function(a){i({type:"started"}),t=e.localStream,N(a)}),e.on("close",function(){t.getTracks().forEach(function(e){e.stop()}),f({})}),f({type:"call",call:e})}function F(){x.send({type:"rejected"}),i({type:"ended"}),f({})}return Object(r.useEffect)(function(){var e;a&&(e=new b.a(a,E),w({peer:e})),e&&(e.on("call",function(){var e=Object(o.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:a=e.sent,t.answer(a),P(t);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.on("connection",function(e){e.on("data",function(t){"endCall"!==t.type?(f({type:"incomingRequest",data:t.data}),k(e)):f({})})}))},[a]),Object(r.useEffect)(function(){if("startCall"===c.type){var e=h.peer.connect(t);e.on("open",function(){e.send({type:"request",data:a})}),e.on("data",function(e){"rejected"===e.type&&(f({}),i({type:"ended"}))}),k(e)}},[c.type]),l.a.createElement(l.a.Fragment,null,l.a.createElement(v,{className:"incomingRequest"===(null===d||void 0===d?void 0:d.type)?"show":"hide",reject:F,accept:_}),l.a.createElement("div",{className:"video-chat ".concat("call"===(null===d||void 0===d?void 0:d.type)||"startCall"===c.type?"video-active":"video-hide")},"startCall"===c.type&&l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"animate"}),l.a.createElement("div",{className:"started-calling"},c.user.username.slice(0,2))),"startCall"!==c.type&&l.a.createElement("video",{autoPlay:!0,ref:function(e){return e&&y?e.srcObject=y:""}}),l.a.createElement("div",{className:"video-chat-controll"},l.a.createElement("i",{className:"fas fa-microphone-alt-slash"}),l.a.createElement("i",{onClick:function(){d.call?d.call.close():(f({}),i({type:"ended"}),x.send({type:"endCall"}))},className:"fas fa-phone-slash"}))))}a(201);function j(){var e=Object(r.useContext)(y);return l.a.createElement("div",{className:"initial-screen"},l.a.createElement("h2",null,e.first_name," ",e.last_name,l.a.createElement("br",null),"Welcom to my application."))}a(202);var O=l.a.memo(function(e){var t=e.usersList,a=e.pageState,c=e.setSelectedUser,s=Object(r.useState)([]),o=Object(n.a)(s,2),i=o[0],u=o[1],m=Object(r.useContext)(y),d=Object(r.useState)([]),f=Object(n.a)(d,2),p=f[0],g=f[1],v=Object(r.useState)([]),h=Object(n.a)(v,2),b=h[0],E=h[1];function w(e){c({id:e.target.getAttribute("data-id"),username:e.target.innerText})}function j(e){return e.map(function(e,t){var a,n,r=(a=16777214,"#"+Math.floor(Math.random()*Math.floor(a)).toString(16)).padEnd(7,"0"),c=(n=r,.2126*parseInt(n[1]+n[2],16)+.7152*parseInt(n[3]+n[4],16)+.0722*parseInt(n[5]+n[6],16)<126);return e.login===m.login?"":l.a.createElement("li",{onClick:w,key:t,"data-id":e.id},l.a.createElement("span",{style:{background:r,color:c?"#fff":"#000"}},l.a.createElement("div",{className:"status ".concat(e.isOnline?"online":"offline")}),e.first_name[0],e.last_name[0]),e.first_name," ",e.last_name)})}return Object(r.useEffect)(function(){u(t)},[t]),l.a.createElement("div",{className:"user-list-wrapper"},l.a.createElement("div",{className:"user-info"},l.a.createElement("h3",null,m.first_name," ",m.last_name),l.a.createElement("i",{onClick:function(){localStorage.removeItem("logined"),a("Login"),window.location.reload()},className:"fas fa-sign-out-alt"})),l.a.createElement("div",{className:"list-controllers"},l.a.createElement("button",{className:"user-changer"},"My Contacts"),l.a.createElement("button",{className:"user-changer"},"All Users")),l.a.createElement("input",{type:"text",value:p,onChange:function(e){e.persist(),g(e.target.value),E(function(){return t.filter(function(e){return e.login!==m.login&&e.first_name.includes(p)||e.last_name.includes(p)})}),e.target.value||E([])},className:"find user",placeholder:"Start typing"}),l.a.createElement("ul",{className:"user-list"},b.length||p.length?j(b):j(i)))}),y=l.a.createContext();function N(){var e=Object(r.useState)([]),t=Object(n.a)(e,2),a=t[0],c=t[1],i=Object(r.useState)({}),u=Object(n.a)(i,2),m=u[0],d=u[1],f=Object(r.useState)(null),h=Object(n.a)(f,2),b=h[0],E=h[1],N=Object(r.useState)(""),S=Object(n.a)(N,2),C=S[0],x=S[1],k=Object(r.useContext)(_);function L(){return P.apply(this,arguments)}function P(){return(P=Object(o.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("http://localhost:8000/offline?st=false",{withCredentials:!0});case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function F(){return D.apply(this,arguments)}function D(){return(D=Object(o.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("http://localhost:8000/offline?st=true",{withCredentials:!0});case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}return Object(r.useEffect)(function(){return Object(o.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("http://localhost:8000/users",{withCredentials:!0});case 2:return t=e.sent,e.next=5,p.a.get("http://localhost:8000/allUsers",{withCredentials:!0});case 5:a=e.sent,c(a.data),d(t.data);case 8:case"end":return e.stop()}},e)}))(),window.addEventListener("beforeunload",L),localStorage.getItem("logined")&&window.addEventListener("load",F),function(){window.removeEventListener("load",F),window.removeEventListener("beforeunload",L)}},[]),l.a.createElement(l.a.Fragment,null,"request"===C.type&&l.a.createElement(v,null),l.a.createElement("div",{className:"chat-wrapper"},l.a.createElement(y.Provider,{value:m},l.a.createElement(O,{usersList:a,pageState:k,setSelectedUser:E}),!b&&l.a.createElement(j,null),b&&l.a.createElement(g,{setCallStatus:x,pageState:k,selectedUser:b}),l.a.createElement(w,{setCallStatus:x,callStatus:C,pageState:k,callNumber:null===b||void 0===b?void 0:b.id,myNumber:m.id}))))}var S=a(95),C=a(94);a(128);function x(e){var t=e.setPageState,a=Object(r.useState)({login:"",password:""}),c=Object(n.a)(a,2),i=c[0],u=c[1],m=Object(r.useState)(!1),f=Object(n.a)(m,2),g=f[0],v=f[1];function h(){return(h=Object(o.a)(s.a.mark(function e(a){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),i.login&&i.password){e.next=3;break}return e.abrupt("return");case 3:return v(!0),e.next=6,p.a.post("http://localhost:8000/auth",i,{withCredentials:!0});case 6:200===e.sent.status&&(localStorage.setItem("logined",!0),t("Logined")),v(!1);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(e){e.persist(),u(function(t){var a;return Object(C.a)({},t,Object(S.a)({},e.target.name,null===(a=e.target)||void 0===a?void 0:a.value))})}return l.a.createElement("div",{className:"login-wrap"},l.a.createElement("div",null,l.a.createElement("form",{className:"user-connection",onSubmit:function(e){return h.apply(this,arguments)}},g&&l.a.createElement(d,null),l.a.createElement("h2",{className:"form-signin-heading"},"Sign in"),l.a.createElement("label",{htmlFor:"login"},"Login"),l.a.createElement("input",{id:"login",placeholder:"login",type:"text",name:"login",value:i.login,onChange:b}),l.a.createElement("label",{htmlFor:"login"},"Passowrd"),l.a.createElement("input",{type:"password",id:"password",className:"form-control",name:"password",placeholder:"password",value:i.password,onChange:b}),l.a.createElement("input",{className:"submitButton",type:"submit",value:"Login"}),l.a.createElement("h2",null,"Don't have an account?"),l.a.createElement("button",{onClick:function(){return t("Reg")},className:"reg_btn"},"Create an account"))))}function k(e){var t=e.setPageState,a=Object(r.useState)({login:"",password:"",confPassword:"",email:""}),c=Object(n.a)(a,2),i=c[0],u=c[1],m=Object(r.useState)(!1),f=Object(n.a)(m,2),g=f[0],v=f[1];function h(){return(h=Object(o.a)(s.a.mark(function e(a){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),i.login&&i.password){e.next=3;break}return e.abrupt("return");case 3:return v(!0),e.prev=4,e.next=7,p.a.post("http://localhost:8000/register",i);case 7:n=e.sent,console.log(n),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),v(!1);case 14:v(!1),t("Login");case 16:case"end":return e.stop()}},e,null,[[4,11]])}))).apply(this,arguments)}function b(e){e.persist(),u(function(t){var a;return Object(C.a)({},t,Object(S.a)({},e.target.name,null===(a=e.target)||void 0===a?void 0:a.value))})}return l.a.createElement("div",{className:"login-wrap"},l.a.createElement("div",null,l.a.createElement("form",{className:"user-connection",onSubmit:function(e){return h.apply(this,arguments)}},g&&l.a.createElement(d,null),l.a.createElement("h2",{className:"form-signin-heading"},"Sign up"),l.a.createElement("label",{htmlFor:"login"},"Login"),l.a.createElement("input",{id:"login",placeholder:"login",type:"text",name:"login",value:i.login,onChange:b}),l.a.createElement("label",{htmlFor:"login"},"Passowrd"),l.a.createElement("input",{type:"password",autoComplete:"off",id:"password",className:"form-control",name:"password",placeholder:"password",value:i.password,onChange:b}),l.a.createElement("label",{htmlFor:"confPassword"},"Confirm Passowrd"),l.a.createElement("input",{id:"confPassword",autoComplete:"off",placeholder:"Password",type:"password",name:"confPassword",value:i.confPassword,onChange:b}),l.a.createElement("label",{htmlFor:"login"},"Email (optional)"),l.a.createElement("input",{id:"email",placeholder:"email",type:"mail",name:"email",value:i.email,onChange:b}),l.a.createElement("label",{htmlFor:"login"},"First Name"),l.a.createElement("input",{id:"first_name",placeholder:"first_name",type:"text",name:"first_name",value:i.first_name,onChange:b}),l.a.createElement("label",{htmlFor:"login"},"Last Name"),l.a.createElement("input",{id:"last_name",placeholder:"last_name",type:"mail",name:"last_name",value:i.last_name,onChange:b}),l.a.createElement("input",{className:"submitButton",type:"submit",value:"Start!"}),l.a.createElement("h2",null,"Do have an account?"),l.a.createElement("button",{onClick:function(){return t("Login")},className:"reg_btn"},"Sign In"))))}a.d(t,"PageState",function(){return _}),a.d(t,"default",function(){return L});var _=l.a.createContext();function L(){var e=Object(r.useState)("Login"),t=Object(n.a)(e,2),a=t[0],c=t[1];if(!localStorage.getItem("logined")){if("Login"===a)return l.a.createElement(x,{setPageState:c});if("Reg"===a)return l.a.createElement(k,{setPageState:c})}return l.a.createElement(r.Suspense,{fallback:l.a.createElement("div",{className:"spinner-main"},l.a.createElement(d,null))},l.a.createElement(_.Provider,{value:c},l.a.createElement(N,{user:a.users})))}}}]);
//# sourceMappingURL=5.0375c9c0.chunk.js.map