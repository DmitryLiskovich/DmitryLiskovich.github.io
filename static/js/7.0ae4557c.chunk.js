(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{163:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=163},164:function(e,t,a){},165:function(e,t,a){},166:function(e,t,a){},168:function(e,t){},169:function(e,t){},170:function(e,t,a){},171:function(e,t,a){},201:function(e,t){},204:function(e,t,a){},205:function(e,t,a){},210:function(e,t,a){"use strict";a.r(t);var n=a(37),r=a(12),c=a(0),l=a.n(c),s=a(43),u=a.n(s),i=a(42),o=a(44),m=a(162),f=a.n(m),d=a(54),p=a.n(d);a(164),a(165);var g=function(e){var t=Object(c.useState)([]),a=Object(r.a)(t,2),n=a[0],s=a[1],u=Object(c.useState)({state:!1,name:null}),o=Object(r.a)(u,2),m=o[0],f=o[1],d=e.selectedUser,p=e.socket,g="",E=Object(c.useRef)(null),v=Object(c.useRef)(null);return Object(c.useEffect)(function(){E.current&&(E.current.scrollTop=E.current.scrollHeight)},[n]),Object(c.useEffect)(function(){p.on("message-from",function(e){"typing"===e.type?f({state:!0,name:e.message}):"connect"===e.type?s(function(t){return[].concat(Object(i.a)(t),[{message:e.message,id:null}])}):"typing-end"===e.type?f({state:!1,name:null}):s(function(t){return[].concat(Object(i.a)(t),[{message:e.input,id:e.id}])})})},[]),l.a.createElement("div",{className:"TextChat"},l.a.createElement("div",{ref:E,className:"messages-wrap"},n.map(function(e,t){var a="You"===e.id;return e.id?l.a.createElement("div",{key:t,className:"message ".concat(a&&"my_message")},l.a.createElement("p",null,e.message),l.a.createElement("p",{className:"id"},e.id)):l.a.createElement("div",{key:t,className:"message-connect"},l.a.createElement("p",null,e.message))})),l.a.createElement("div",{className:"input"},l.a.createElement("form",{onSubmit:function(e){e.preventDefault(),p.emit("message-from",{input:g,id:d}),s([].concat(Object(i.a)(n),[{message:g,id:"You"}])),e.target.message.value="",v.current.focus()}},l.a.createElement("input",{ref:v,name:"message",placeholder:m.state?m.name:"message",onInput:function(){return p.emit("typing...")},onChange:function(e){g=e.target.value},type:"text"}),l.a.createElement("button",{type:"submit"},"Send"))))};a(166);function E(e){var t=e.message;return l.a.createElement("div",{className:"modal-wrap"},l.a.createElement("div",{className:"modal"},l.a.createElement("h2",null,t)))}var v,h=a(167),b=a.n(h);a(170);function j(e){var t=Object(c.useState)([]),a=Object(r.a)(t,2),s=a[0],u=a[1],o=Object(r.a)(e.drawing,2),m=o[0],f=o[1],d=Object(c.useState)(),p=Object(r.a)(d,2),g=p[0],E=p[1],j=Object(c.useRef)(null),O=Object(c.useRef)(null);Object(c.useEffect)(function(){function e(e){v&&(v.selected=!1),2===e.button&&v&&(s.forEach(function(e){return e.remove()}),u([])),v=new h.Path({strokeColor:"#152238",selected:!0}),u(function(e){return[].concat(Object(i.a)(e),[v])}),["mousemove","touchmove"].forEach(function(e){return j.current.addEventListener(e,t)}),["mouseup","touchend"].forEach(function(e){return j.current.addEventListener(e,a)})}function t(e){v&&e.layerX&&e.layerX>0?v.add(e.layerX,e.layerY):v.add(e.targetTouches[0].pageX,e.targetTouches[0].pageY-56)}function a(){v&&(v.simplify(),v.selected=!1),j.current.removeEventListener("mousemove",t),j.current.removeEventListener("mouseup",a)}b.a.setup(j.current),["mousedown","touchstart"].forEach(function(t){return j.current.addEventListener(t,e)}),f(Object(n.a)({},m,{drawing:!1})),O.current.value=1},[]),v&&(v.strokeWidth=g);return l.a.createElement("div",{className:"chat-drawing ".concat(m.drawing?"":"hidden")},l.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return f(Object(n.a)({},m,{drawing:!1}))}}),l.a.createElement("canvas",{id:"draw",ref:j}),l.a.createElement("div",{className:"draw-tools"},l.a.createElement("div",null,l.a.createElement("h2",null,"Layers"),l.a.createElement("ul",{onClick:function(e){if("LI"===e.target.tagName)s.forEach(function(e){return e.selected=!1}),s[+e.target.getAttribute("data-index")].selected=!0;else if("I"===e.target.tagName){s[+e.target.parentElement.getAttribute("data-index")].remove();var t=s;t.splice(+e.target.parentElement.getAttribute("data-index"),1),u(function(e){return Object(i.a)(t)})}}},s.map(function(e,t){return l.a.createElement("li",{"data-index":t,key:t},"Line - ",t," ",l.a.createElement("i",{className:"fas fa-trash-alt"}))})),l.a.createElement("div",{className:"tools"},g,l.a.createElement("input",{onInput:function(e){return E(e.target.value)},ref:O,type:"range",min:"1",max:"100"})))))}a(171);function O(e){var t=e.stateFull,a=e.streams,c=e.myVideoStream,s=e.peers,i=e.socket,m=Object(r.a)(t,2),f=m[0],d=m[1];function p(){return(p=Object(o.a)(u.a.mark(function e(){var t;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getDisplayMedia();case 2:t=e.sent,c.current.srcObject=t,s.forEach(function(e){f.peer.call(e.callId,t),i.emit("share-screen-user",f.name)}),d(function(e){return Object(n.a)({},e,{sharingStream:t})});case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"video-chat"},l.a.createElement("div",{className:"video-chat__wrap"},l.a.createElement("div",{className:"video-chat__wrap_my"},l.a.createElement("video",{className:"my",ref:c,autoPlay:!0})),l.a.createElement("div",{className:"video-chat__wrap_remote"},a.map(function(e,t){return e.stream.active||e.sharingStream.active?l.a.createElement("video",{className:"video",width:"auto",autoPlay:!0,key:t,ref:function(t){return t?t.srcObject=e.sharingStream||e.stream:""}}):""})),l.a.createElement("div",{className:"button-section"},l.a.createElement("div",{onClick:function(){return f.peercall?f.peercall.close():f.peer.close()},className:"reject calling"},l.a.createElement("i",{className:"fas fa-phone-slash"})),l.a.createElement("i",{className:"fas fa-microphone"}),l.a.createElement("i",{className:"fas fa-volume-up"}),l.a.createElement("i",{onClick:function(){return p.apply(this,arguments)},className:"fas fa-share-alt"})))))}var N,y,w,k,S,I={config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}};function C(e){var t=e.user.name,a=Object(c.useState)({drawing:!0,catchIt:!1,calling:!1,chatState:!1,peer:new f.a(I),localStream:null,peercall:null,rejected:!1,sharingStream:null,name:t}),s=Object(r.a)(a,2),m=s[0],d=s[1],p=Object(c.useState)([]),v=Object(r.a)(p,2),h=v[0],b=v[1],C=Object(c.useRef)(null),x=e.socket,T=Object(c.useState)([]),_=Object(r.a)(T,2),L=_[0],U=_[1];function A(e,t,a){return D.apply(this,arguments)}function D(){return(D=Object(o.a)(u.a.mark(function e(t,a,r){var c,l;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 2:c=e.sent,l=a,"answer"===t?(a.answer(c),y=a.peer,d(function(e){return Object(n.a)({},e,{catchIt:!1,calling:!0,peercall:l})})):(l=l.call(y,c),d(function(e){return Object(n.a)({},e,{calling:!0,peercall:l})})),l.on("stream",function(e){return R(e,c,r)}),l.on("close",function(e){h.forEach(function(e){e.stream.getTracks().forEach(function(e){return e.stop()}),e.sharingStream&&e.sharingStream.getTracks().forEach(function(e){return e.stop()})}),c.getTracks().forEach(function(e){return e.stop()}),0===h.length&&d(function(e){return Object(n.a)({},e,{calling:!1})})});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function F(e){w=e,d(function(e){return Object(n.a)({},e,{rejected:!0})}),setTimeout(function(){d(function(e){return Object(n.a)({},e,{rejected:!1})})},5e3)}function M(e){y=e.currentTarget.parentElement.parentElement.getAttribute("data-number");var a=m.peer.connect(y);a.on("open",function(){a.on("data",function(e){if("rejected"!==e.type){if(!navigator.getUserMedia)return void F("You don't have web camera or you have http connection");A("call",m.peer,e.user)}else"rejected"===e.type&&F("Your call has been rejected")}),a.send({type:"request",user:t})})}function R(e,t,a){if(t.getAudioTracks().enabled=!1,C.current.srcObject=t,S){var n=h.map(function(t){return S===t.user&&(t.sharingStream=e),t});b(n)}e!==N&&(b(function(t){return[].concat(Object(i.a)(t),[{user:a,stream:e}])}),N=e)}function Y(){m.peercall.send({type:"rejected",user:t}),d(function(e){return Object(n.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function P(e){k=e.currentTarget.parentElement.parentElement.getAttribute("data-name"),m.peercall.send({type:"accepted",user:t}),d(function(e){return Object(n.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}return Object(c.useEffect)(function(){m.peer.on("open",function(e){x.send({peerID:e,name:t})}),m.peer.on("connection",function(e){e.on("data",function(t){d(function(t){return Object(n.a)({},t,{catchIt:!0,peercall:e})})}),d(function(t){return Object(n.a)({},t,{peercall:e})})}),x.on("message",function(e){U(e.filter(function(e){return e.userName!==t}))}),x.on("share-screen-user",function(e){S=e}),m.peer.on("call",function(e){navigator.getUserMedia?A("answer",e,k):e.close()})},[]),l.a.createElement(l.a.Fragment,null,l.a.createElement(j,{drawing:[m,d]}),l.a.createElement("div",{className:"App"},m.rejected&&l.a.createElement(E,{message:w}),l.a.createElement("div",{className:"users-list ".concat(m.calling||m.chatState?"hidden":"")},l.a.createElement("ul",null,l.a.createElement("li",{className:"header"},l.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return d(Object(n.a)({},m,{drawing:!0}))}}),l.a.createElement("h1",null,"Users List"),l.a.createElement("i",{className:"far fa-comments chat-change",onClick:function(){return d(Object(n.a)({},m,{chatState:!0}))}})),L.map(function(e,t){return l.a.createElement("li",{"data-name":e.userName,"data-number":e.callId,key:t},l.a.createElement("div",{className:"user-name"},e.userName.slice(0,2)),l.a.createElement("p",null,e.userName),l.a.createElement("div",{className:"button"},l.a.createElement("div",{onClick:m.catchIt?P:M,className:"calling ".concat(m.catchIt&&m.peercall.peer===e.callId?"pulse-button":"")},l.a.createElement("i",{className:"fas fa-phone"})),m.catchIt&&m.peercall.peer===e.callId&&l.a.createElement("div",{onClick:Y,className:"reject calling"},l.a.createElement("i",{className:"fas fa-phone-slash"}))))}))),m.calling&&l.a.createElement("div",{className:"video-chat_from-chat ".concat(!m.calling&&"hidden")},l.a.createElement(O,{socket:x,myVideoStream:C,streams:h,stateFull:[m,d],peers:L})),!m.calling&&l.a.createElement(l.a.Fragment,null,l.a.createElement("i",{onClick:function(){return d(function(e){return Object(n.a)({},e,{chatState:!1})})},className:"fas fa-times close-button ".concat(m.chatState?"":"hidden")}),l.a.createElement("div",{className:"text-chat ".concat(!m.chatState&&"hidden")},l.a.createElement(g,{selectedUser:t,socket:x})))))}setInterval(function(){p.a.get("https://rocky-reef-68087.herokuapp.com/email")},3e5);var x,T=a(172),_=a.n(T);a(204),a(205);function L(){return l.a.createElement("div",{className:"lds-dual-ring"})}function U(){var e=Object(c.useState)({spinner:!1,loggined:!1,userIsCreated:!1,users:{}}),t=Object(r.a)(e,2),a=t[0],s=t[1];return Object(c.useEffect)(function(){return document.title="Chat",x.on("message",function(e){"err"===e.type?s(function(e){return Object(n.a)({},e,{spinner:!1,loggined:!1,userIsCreated:!0})}):s(function(e){return Object(n.a)({},e,{spinner:!1,loggined:!0})})}),function(){x.close()}},[]),a.loggined?l.a.createElement(c.Suspense,{fallback:l.a.createElement("div",{className:"spinner-main"},l.a.createElement(L,null))},l.a.createElement(C,{socket:x,user:a.users})):l.a.createElement("div",{className:"login-wrap"},l.a.createElement("form",{className:"user-connection",onSubmit:function(e){s(function(t){return Object(n.a)({},t,{spinner:!0,users:{name:e.target.name.value,room:e.target.room.value}})}),e.preventDefault(),x.emit("join",e.target.room.value,e.target.name.value)}},a.spinner&&l.a.createElement(L,null),l.a.createElement("h2",{className:"form-signin-heading"},"Please select room and enter your nickname"),l.a.createElement("select",{type:"",className:"form-control",name:"room",required:!0},l.a.createElement("option",null,"First room"),l.a.createElement("option",null,"Second room")),l.a.createElement("input",{type:"text",className:"form-control",name:"name",placeholder:"USER NAME",required:!0}),a.userIsCreated&&l.a.createElement("div",{className:"alert"},"User already in this room"),l.a.createElement("input",{className:"submitButton",type:"submit",value:"Enter"})))}a.d(t,"default",function(){return U}),x=_.a.connect("https://rocky-reef-68087.herokuapp.com")}}]);
//# sourceMappingURL=7.0ae4557c.chunk.js.map