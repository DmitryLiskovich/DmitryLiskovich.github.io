(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{163:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=163},164:function(e,t,a){},165:function(e,t,a){},166:function(e,t,a){},168:function(e,t){},169:function(e,t){},170:function(e,t,a){},200:function(e,t){},203:function(e,t,a){},204:function(e,t,a){},209:function(e,t,a){"use strict";a.r(t);var n=a(9),c=a(0),r=a.n(c),l=a(42),o=a(52),i=a.n(o),s=a(53),u=a(37),m=a(162),f=a.n(m),d=a(54),g=a.n(d);a(164),a(165);var p=function(e){var t=Object(c.useState)([]),a=Object(n.a)(t,2),o=a[0],i=a[1],s=Object(c.useState)({state:!1,name:null}),u=Object(n.a)(s,2),m=u[0],f=u[1],d=e.selectedUser,g=e.socket,p="",E=Object(c.useRef)(null),v=Object(c.useRef)(null);return Object(c.useEffect)(function(){E.current&&(E.current.scrollTop=E.current.scrollHeight)},[o]),Object(c.useEffect)(function(){g.on("message-from",function(e){"typing"===e.type?f({state:!0,name:e.message}):"connect"===e.type?i(function(t){return[].concat(Object(l.a)(t),[{message:e.message,id:null}])}):"typing-end"===e.type?f({state:!1,name:null}):i(function(t){return[].concat(Object(l.a)(t),[{message:e.input,id:e.id}])})})},[]),r.a.createElement("div",{className:"TextChat"},r.a.createElement("div",{ref:E,className:"messages-wrap"},o.map(function(e,t){var a="You"===e.id;return e.id?r.a.createElement("div",{key:t,className:"message ".concat(a&&"my_message")},r.a.createElement("p",null,e.message),r.a.createElement("p",{className:"id"},e.id)):r.a.createElement("div",{key:t,className:"message-connect"},r.a.createElement("p",null,e.message))})),r.a.createElement("div",{className:"input"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),g.emit("message-from",{input:p,id:d}),i([].concat(Object(l.a)(o),[{message:p,id:"You"}])),e.target.message.value="",v.current.focus()}},r.a.createElement("input",{ref:v,name:"message",placeholder:m.state?m.name:"message",onInput:function(){return g.emit("typing...")},onChange:function(e){p=e.target.value},type:"text"}),r.a.createElement("button",{type:"submit"},"Send"))))};a(166);function E(e){var t=e.message;return r.a.createElement("div",{className:"modal-wrap"},r.a.createElement("div",{className:"modal"},r.a.createElement("h2",null,t)))}var v=a(167),b=a.n(v);a(170);function j(e){var t=Object(c.useState)([]),a=Object(n.a)(t,2),o=a[0],i=a[1],s=Object(c.useRef)(null),m=Object(n.a)(e.drawing,2),f=m[0],d=m[1];Object(c.useEffect)(function(){var e;function t(t){e&&t.layerX>0&&e.add(t.layerX,t.layerY)}function a(){e&&(e.simplify(),e.selected=!1),s.current.removeEventListener("mousemove",t),s.current.removeEventListener("mouseup",a)}b.a.setup(s.current),s.current.addEventListener("mousedown",function(n){e&&(e.selected=!1);2===n.button&&e&&(o.forEach(function(e){return e.remove()}),i([]));e=new v.Path({strokeColor:"#152238",selected:!0}),i(function(t){return[].concat(Object(l.a)(t),[e])}),s.current.addEventListener("mousemove",t),s.current.addEventListener("mouseup",a)}),d(Object(u.a)({},f,{drawing:!1}))},[]);return r.a.createElement("div",{className:"chat-drawing ".concat(f.drawing?"":"hidden")},r.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return d(Object(u.a)({},f,{drawing:!1}))}}),r.a.createElement("canvas",{id:"draw",ref:s}),r.a.createElement("div",{className:"draw-tools"},r.a.createElement("div",null,r.a.createElement("h2",null,"Layers"),r.a.createElement("ul",{onClick:function(e){if("LI"===e.target.tagName)o.forEach(function(e){return e.selected=!1}),o[+e.target.getAttribute("data-index")].selected=!0;else if("I"===e.target.tagName){o[+e.target.parentElement.getAttribute("data-index")].remove();var t=o;t.splice(+e.target.parentElement.getAttribute("data-index"),1),console.log(t),i(function(e){return Object(l.a)(t)})}}},o.map(function(e,t){return r.a.createElement("li",{"data-index":t,key:t},"Line - ",t," ",r.a.createElement("i",{className:"fas fa-trash-alt"}))})))))}var h,O,N,y={config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}};function k(e){var t=Object(c.useState)({drawing:!0,catchIt:!1,calling:!1,chatState:!1,peer:new f.a(y),localStream:null,peercall:null,rejected:!1}),a=Object(n.a)(t,2),o=a[0],m=a[1],d=Object(c.useState)([]),g=Object(n.a)(d,2),v=g[0],b=g[1],k=Object(c.useState)(),w=Object(n.a)(k,2),S=w[0],U=w[1],C=Object(c.useRef)(null),I=e.user.name,L=e.socket,M=Object(c.useState)({}),x=Object(n.a)(M,2),A=x[0],T=x[1];function F(e){O=e.currentTarget.parentElement.parentElement.getAttribute("data-number");var t=o.peer.connect(O);t.on("open",function(){t.on("data",function(e){if("rejected"!==e){if(!navigator.getUserMedia)return N="You don't have web camera or you have http connection",m(function(e){return Object(u.a)({},e,{rejected:!0})}),void setTimeout(function(){m(function(e){return Object(u.a)({},e,{rejected:!1})})},5e3);navigator.getUserMedia({video:!0,audio:!1},function(e){var t=o.peer.call(O,e);t.on("stream",function(t){return R(t,e)}),t.on("close",function(t){e.getTracks().forEach(function(e){return e.stop()}),m(function(e){return Object(u.a)({},e,{calling:!1})})}),m(function(e){return Object(u.a)({},e,{calling:!0,peercall:t})})},P)}else"rejected"===e&&(N="Your call has been rejected",m(function(e){return Object(u.a)({},e,{rejected:!0})}),setTimeout(function(){m(function(e){return Object(u.a)({},e,{rejected:!1})})},5e3))}),t.send("request")})}function R(e,t){t.getAudioTracks().enabled=!1,C.current.srcObject=t,e!==h&&(b(function(t){return[].concat(Object(l.a)(t),[e])}),h=e)}function Y(){o.peercall.send("rejected"),m(function(e){return Object(u.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function D(){o.peercall.send("accepted"),m(function(e){return Object(u.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function P(e){alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e))}return Object(c.useEffect)(function(){o.peer.on("open",function(e){L.send(e)}),o.peer.on("connection",function(e){e.on("data",function(t){m(function(t){return Object(u.a)({},t,{catchIt:!0,peercall:e})})}),m(function(t){return Object(u.a)({},t,{peercall:e})})}),L.on("message",function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:delete t[I],T(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),o.peer.on("call",function(e){navigator.getUserMedia?navigator.getUserMedia({video:!0,audio:!1},function(t){e.answer(t),O=e.peer,e.on("close",function(e){t.getTracks().forEach(function(e){return e.stop()}),m(function(e){return Object(u.a)({},e,{calling:!1})})}),e.on("stream",function(e){return R(e,t)}),m(function(t){return Object(u.a)({},t,{catchIt:!1,calling:!0,peercall:e})})},P):e.close()})},[]),Object(c.useEffect)(function(){m(S?function(e){return Object(u.a)({},e,{chatState:!0})}:function(e){return Object(u.a)({},e,{chatState:!1})})},[S]),r.a.createElement(r.a.Fragment,null,r.a.createElement(j,{drawing:[o,m]}),r.a.createElement("div",{className:"App"},o.rejected&&r.a.createElement(E,{message:N}),r.a.createElement("div",{className:"users-list ".concat(o.calling||o.chatState?"hidden":"")},r.a.createElement("ul",{onClick:function(e){if("UL"!==e.target.tagName&&"calling"!==e.target.className&&"I"!==e.target.tagName&&"calling pulse-button"!==e.target.className){for(var t=e.target;!t.getAttribute("data-name");)t=t.parentElement;var a={};a[t.getAttribute("data-name")]=t.getAttribute("data-number"),U(a)}}},r.a.createElement("li",{className:"header"},r.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return m(Object(u.a)({},o,{drawing:!0}))}}),r.a.createElement("h1",null,"Users List"),r.a.createElement("i",{className:"far fa-comments chat-change",onClick:function(){return m(Object(u.a)({},o,{chatState:!0}))}})),Object.keys(A).map(function(e,t){return r.a.createElement("li",{"data-name":e,className:"".concat(S&&S[e]&&"active"),"data-number":A[e],key:t},r.a.createElement("div",{className:"user-name"},e.slice(0,2)),r.a.createElement("p",null,e),r.a.createElement("div",{className:"button"},r.a.createElement("div",{onClick:o.catchIt?D:F,className:"calling ".concat(o.catchIt&&o.peercall.peer===A[e]?"pulse-button":"")},r.a.createElement("i",{className:"fas fa-phone"})),o.catchIt&&o.peercall.peer===A[e]&&r.a.createElement("div",{onClick:Y,className:"reject calling"},r.a.createElement("i",{className:"fas fa-phone-slash"}))))}))),o.calling&&r.a.createElement("div",{className:"video-chat ".concat(!o.calling&&"hidden")},r.a.createElement(function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"chat-section"},r.a.createElement("div",{className:"chat-wrap"},r.a.createElement("div",{className:"my_wrapp"},r.a.createElement("video",{muted:!0,className:"my",ref:C,autoPlay:!0})),r.a.createElement("div",{className:"chat"},v.map(function(e,t){return e.active?r.a.createElement("video",{className:"video",autoPlay:!0,key:t,ref:function(t){return t?t.srcObject=e:""}}):""})),r.a.createElement("div",{className:"button-section"},r.a.createElement("div",{onClick:function(){return o.peercall?o.peercall.close():o.peer.close()},className:"reject calling"},r.a.createElement("i",{className:"fas fa-phone-slash"})),r.a.createElement("i",{className:"fas fa-microphone"}),r.a.createElement("i",{className:"fas fa-volume-up"})))))},null)),!o.calling&&r.a.createElement(r.a.Fragment,null,r.a.createElement("i",{onClick:function(){return m(function(e){return Object(u.a)({},e,{chatState:!1})})},className:"fas fa-times close-button ".concat(o.chatState?"":"hidden")}),r.a.createElement("div",{className:"text-chat ".concat(!o.chatState&&"hidden")},r.a.createElement(p,{selectedUser:I,socket:L})))))}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,setInterval(function(){g.a.get("https://rocky-reef-68087.herokuapp.com/email")},3e5);var w,S=a(171),U=a.n(S);a(203),a(204);function C(){return r.a.createElement("div",{className:"lds-dual-ring"})}function I(){var e=Object(c.useState)(!1),t=Object(n.a)(e,2),a=t[0],l=t[1],o=Object(c.useState)({}),i=Object(n.a)(o,2),s=i[0],u=i[1],m=Object(c.useState)(!0),f=Object(n.a)(m,2),d=f[0],g=f[1],p=Object(c.useState)(!0),E=Object(n.a)(p,2),v=E[0],b=E[1];return Object(c.useEffect)(function(){document.title="Chat",w.on("message",function(e){"err"===e.type?(l(!1),g(!1)):(b(!0),l(!0))})},[]),a?r.a.createElement(k,{socket:w,user:s}):r.a.createElement("div",{className:"login-wrap"},r.a.createElement("form",{className:"user-connection",onSubmit:function(e){b(!1),e.preventDefault(),u({name:e.target.name.value,room:e.target.room.value}),w.emit("join",e.target.room.value,e.target.name.value)}},!v&&r.a.createElement(C,null),r.a.createElement("h2",{className:"form-signin-heading"},"Please select room and enter your nickname"),r.a.createElement("select",{type:"",className:"form-control",name:"room",required:!0},r.a.createElement("option",null,"First room"),r.a.createElement("option",null,"Second room")),r.a.createElement("input",{type:"text",className:"form-control",name:"name",placeholder:"USER NAME",required:!0}),!d&&r.a.createElement("div",{className:"alert"},"User already in this room"),r.a.createElement("input",{className:"submitButton",type:"submit",value:"Enter"})))}a.d(t,"default",function(){return I}),w=U.a.connect("https://rocky-reef-68087.herokuapp.com")}}]);
//# sourceMappingURL=7.837ce40f.chunk.js.map