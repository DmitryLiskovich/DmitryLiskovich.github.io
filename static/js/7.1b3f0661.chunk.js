(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{197:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=197},198:function(e,t,a){},199:function(e,t,a){},200:function(e,t,a){},202:function(e,t){},203:function(e,t){},204:function(e,t,a){},205:function(e,t,a){},210:function(e,t,a){"use strict";a.r(t);var n=a(43),c=a(52),r=a.n(c),l=a(53),o=a(37),i=a(9),u=a(0),s=a.n(u),m=a(196),f=a.n(m),d=a(54),g=a.n(d);a(198),a(199);var p=function(e){var t=Object(u.useState)([]),a=Object(i.a)(t,2),c=a[0],r=a[1],l=Object(u.useState)({state:!1,name:null}),o=Object(i.a)(l,2),m=o[0],f=o[1],d=e.selectedUser,g=e.socket,p="",v=Object(u.useRef)(null),E=Object(u.useRef)(null);return Object(u.useEffect)(function(){v.current&&(v.current.scrollTop=v.current.scrollHeight)},[c]),Object(u.useEffect)(function(){g.on("message-from",function(e){"typing"===e.type?f({state:!0,name:e.message}):"connect"===e.type?r(function(t){return[].concat(Object(n.a)(t),[{message:e.message,id:null}])}):"typing-end"===e.type?f({state:!1,name:null}):r(function(t){return[].concat(Object(n.a)(t),[{message:e.input,id:e.id}])})})},[]),s.a.createElement("div",{className:"TextChat"},s.a.createElement("div",{ref:v,className:"messages-wrap"},c.map(function(e,t){var a="You"===e.id;return e.id?s.a.createElement("div",{key:t,className:"message ".concat(a&&"my_message")},s.a.createElement("p",null,e.message),s.a.createElement("p",{className:"id"},e.id)):s.a.createElement("div",{key:t,className:"message-connect"},s.a.createElement("p",null,e.message))})),s.a.createElement("div",{className:"input"},s.a.createElement("form",{onSubmit:function(e){e.preventDefault(),g.emit("message-from",{input:p,id:d}),r([].concat(Object(n.a)(c),[{message:p,id:"You"}])),e.target.message.value="",E.current.focus()}},s.a.createElement("input",{ref:E,name:"message",placeholder:m.state?m.name:"message",onInput:function(){return g.emit("typing...")},onChange:function(e){p=e.target.value},type:"text"}),s.a.createElement("button",{type:"submit"},"Send"))))};a(200);function v(e){var t=e.message;return s.a.createElement("div",{className:"modal-wrap"},s.a.createElement("div",{className:"modal"},s.a.createElement("h2",null,t)))}var E,b=a(201),h=a.n(b);a(204);function j(e){var t=Object(u.useState)([]),a=Object(i.a)(t,2),c=a[0],r=a[1],l=Object(i.a)(e.drawing,2),m=l[0],f=l[1],d=Object(u.useState)(),g=Object(i.a)(d,2),p=g[0],v=g[1],j=Object(u.useRef)(null),O=Object(u.useRef)(null);Object(u.useEffect)(function(){function e(e){E&&(E.selected=!1),2===e.button&&E&&(c.forEach(function(e){return e.remove()}),r([])),E=new b.Path({strokeColor:"#152238",selected:!0}),r(function(e){return[].concat(Object(n.a)(e),[E])}),["mousemove","touchmove"].forEach(function(e){return j.current.addEventListener(e,t)}),["mouseup","touchend"].forEach(function(e){return j.current.addEventListener(e,a)})}function t(e){console.log(e),E&&e.layerX&&e.layerX>0?E.add(e.layerX,e.layerY):E.add(e.targetTouches[0].pageX,e.targetTouches[0].pageY-56)}function a(){E&&(E.simplify(),E.selected=!1),j.current.removeEventListener("mousemove",t),j.current.removeEventListener("mouseup",a)}h.a.setup(j.current),["mousedown","touchstart"].forEach(function(t){return j.current.addEventListener(t,e)}),f(Object(o.a)({},m,{drawing:!1})),O.current.value=1},[]),E&&(E.strokeWidth=p);return s.a.createElement("div",{className:"chat-drawing ".concat(m.drawing?"":"hidden")},s.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return f(Object(o.a)({},m,{drawing:!1}))}}),s.a.createElement("canvas",{id:"draw",ref:j}),s.a.createElement("div",{className:"draw-tools"},s.a.createElement("div",null,s.a.createElement("h2",null,"Layers"),s.a.createElement("ul",{onClick:function(e){if("LI"===e.target.tagName)c.forEach(function(e){return e.selected=!1}),c[+e.target.getAttribute("data-index")].selected=!0;else if("I"===e.target.tagName){c[+e.target.parentElement.getAttribute("data-index")].remove();var t=c;t.splice(+e.target.parentElement.getAttribute("data-index"),1),console.log(t),r(function(e){return Object(n.a)(t)})}}},c.map(function(e,t){return s.a.createElement("li",{"data-index":t,key:t},"Line - ",t," ",s.a.createElement("i",{className:"fas fa-trash-alt"}))})),s.a.createElement("div",{className:"tools"},p,s.a.createElement("input",{onInput:function(e){return v(e.target.value)},ref:O,type:"range",min:"1",max:"100"})))))}a(205);function O(e){var t=e.state,a=e.streams,n=e.myVideoStream;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"video-chat"},s.a.createElement("div",{className:"video-chat__wrap"},s.a.createElement("div",{className:"video-chat__wrap_my"},s.a.createElement("video",{className:"my",ref:n,autoPlay:!0})),s.a.createElement("div",{className:"video-chat__wrap_remote"},a.map(function(e,t){return e.active?s.a.createElement("video",{className:"video",width:"auto",autoPlay:!0,key:t,ref:function(t){return t?t.srcObject=e:""}}):""})),s.a.createElement("div",{className:"button-section"},s.a.createElement("div",{onClick:function(){return t.peercall?t.peercall.close():t.peer.close()},className:"reject calling"},s.a.createElement("i",{className:"fas fa-phone-slash"})),s.a.createElement("i",{className:"fas fa-microphone"}),s.a.createElement("i",{className:"fas fa-volume-up"})))))}a.d(t,"default",function(){return S});var N,w,y,k={config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}};function S(e){var t=Object(u.useState)({drawing:!0,catchIt:!1,calling:!1,chatState:!1,peer:new f.a(k),localStream:null,peercall:null,rejected:!1}),a=Object(i.a)(t,2),c=a[0],m=a[1],d=Object(u.useState)([]),g=Object(i.a)(d,2),E=g[0],b=g[1],h=Object(u.useState)(),S=Object(i.a)(h,2),U=S[0],I=(S[1],Object(u.useRef)(null)),C=e.user.name,_=e.socket,T=Object(u.useState)({}),x=Object(i.a)(T,2),L=x[0],M=x[1];function A(e){w=e.currentTarget.parentElement.parentElement.getAttribute("data-number");var t=c.peer.connect(w);t.on("open",function(){t.on("data",function(e){if("rejected"!==e){if(!navigator.getUserMedia)return y="You don't have web camera or you have http connection",m(function(e){return Object(o.a)({},e,{rejected:!0})}),void setTimeout(function(){m(function(e){return Object(o.a)({},e,{rejected:!1})})},5e3);navigator.getUserMedia({video:!0,audio:!1},function(e){var t=c.peer.call(w,e);t.on("stream",function(t){return Y(t,e)}),t.on("close",function(t){e.getTracks().forEach(function(e){return e.stop()}),m(function(e){return Object(o.a)({},e,{calling:!1})})}),m(function(e){return Object(o.a)({},e,{calling:!0,peercall:t})})},X)}else"rejected"===e&&(y="Your call has been rejected",m(function(e){return Object(o.a)({},e,{rejected:!0})}),setTimeout(function(){m(function(e){return Object(o.a)({},e,{rejected:!1})})},5e3))}),t.send("request")})}function Y(e,t){t.getAudioTracks().enabled=!1,I.current.srcObject=t,e!==N&&(b(function(t){return[].concat(Object(n.a)(t),[e])}),N=e)}function R(){c.peercall.send("rejected"),m(function(e){return Object(o.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function F(){c.peercall.send("accepted"),m(function(e){return Object(o.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function X(e){alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e))}return Object(u.useEffect)(function(){c.peer.on("open",function(e){_.send(e)}),c.peer.on("connection",function(e){e.on("data",function(t){m(function(t){return Object(o.a)({},t,{catchIt:!0,peercall:e})})}),m(function(t){return Object(o.a)({},t,{peercall:e})})}),_.on("message",function(){var e=Object(l.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:delete t[C],M(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),c.peer.on("call",function(e){navigator.getUserMedia?navigator.getUserMedia({video:!0,audio:!1},function(t){e.answer(t),w=e.peer,e.on("close",function(e){t.getTracks().forEach(function(e){return e.stop()}),console.log(E),0===E.length&&m(function(e){return Object(o.a)({},e,{calling:!1})})}),e.on("stream",function(e){return Y(e,t)}),m(function(t){return Object(o.a)({},t,{catchIt:!1,calling:!0,peercall:e})})},X):e.close()})},[]),Object(u.useEffect)(function(){m(U?function(e){return Object(o.a)({},e,{chatState:!0})}:function(e){return Object(o.a)({},e,{chatState:!1})})},[U]),s.a.createElement(s.a.Fragment,null,s.a.createElement(j,{drawing:[c,m]}),s.a.createElement("div",{className:"App"},c.rejected&&s.a.createElement(v,{message:y}),s.a.createElement("div",{className:"users-list ".concat(c.calling||c.chatState?"hidden":"")},s.a.createElement("ul",null,s.a.createElement("li",{className:"header"},s.a.createElement("i",{className:"fas fa-pencil-ruler drawing-mode",onClick:function(){return m(Object(o.a)({},c,{drawing:!0}))}}),s.a.createElement("h1",null,"Users List"),s.a.createElement("i",{className:"far fa-comments chat-change",onClick:function(){return m(Object(o.a)({},c,{chatState:!0}))}})),Object.keys(L).map(function(e,t){return s.a.createElement("li",{"data-name":e,className:"".concat(U&&U[e]&&"active"),"data-number":L[e],key:t},s.a.createElement("div",{className:"user-name"},e.slice(0,2)),s.a.createElement("p",null,e),s.a.createElement("div",{className:"button"},s.a.createElement("div",{onClick:c.catchIt?F:A,className:"calling ".concat(c.catchIt&&c.peercall.peer===L[e]?"pulse-button":"")},s.a.createElement("i",{className:"fas fa-phone"})),c.catchIt&&c.peercall.peer===L[e]&&s.a.createElement("div",{onClick:R,className:"reject calling"},s.a.createElement("i",{className:"fas fa-phone-slash"}))))}))),c.calling&&s.a.createElement("div",{className:"video-chat_from-chat ".concat(!c.calling&&"hidden")},s.a.createElement(O,{myVideoStream:I,streams:E,state:c})),!c.calling&&s.a.createElement(s.a.Fragment,null,s.a.createElement("i",{onClick:function(){return m(function(e){return Object(o.a)({},e,{chatState:!1})})},className:"fas fa-times close-button ".concat(c.chatState?"":"hidden")}),s.a.createElement("div",{className:"text-chat ".concat(!c.chatState&&"hidden")},s.a.createElement(p,{selectedUser:C,socket:_})))))}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,setInterval(function(){g.a.get("https://rocky-reef-68087.herokuapp.com/email")},3e5)}}]);
//# sourceMappingURL=7.1b3f0661.chunk.js.map