(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{163:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=163},165:function(e,t){},166:function(e,t){},167:function(e,t,a){},168:function(e,t,a){},169:function(e,t,a){},199:function(e,t){},202:function(e,t,a){},203:function(e,t,a){},208:function(e,t,a){"use strict";a.r(t);var n=a(9),c=a(0),r=a.n(c),l=a(42),o=a(52),s=a.n(o),u=a(53),i=a(41),m=a(162),f=a.n(m),d=a(54),p=a.n(d),g=a(164),v=a.n(g);a(167),a(168);var E=function(e){var t=Object(c.useState)([]),a=Object(n.a)(t,2),o=a[0],s=a[1],u=Object(c.useState)({state:!1,name:null}),i=Object(n.a)(u,2),m=i[0],f=i[1],d=e.selectedUser,p=e.socket,g="",v=Object(c.useRef)(null),E=Object(c.useRef)(null);return Object(c.useEffect)(function(){v.current&&(v.current.scrollTop=v.current.scrollHeight)},[o]),Object(c.useEffect)(function(){p.on("message-from",function(e){"typing"===e.type?f({state:!0,name:e.message}):"connect"===e.type?s(function(t){return[].concat(Object(l.a)(t),[{message:e.message,id:null}])}):"typing-end"===e.type?f({state:!1,name:null}):s(function(t){return[].concat(Object(l.a)(t),[{message:e.input,id:e.id}])})})},[]),r.a.createElement("div",{className:"TextChat"},r.a.createElement("div",{ref:v,className:"messages-wrap"},o.map(function(e,t){var a="You"===e.id;return e.id?r.a.createElement("div",{key:t,className:"message ".concat(a&&"my_message")},r.a.createElement("p",null,e.message),r.a.createElement("p",{className:"id"},e.id)):r.a.createElement("div",{key:t,className:"message-connect"},r.a.createElement("p",null,e.message))})),r.a.createElement("div",{className:"input"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),p.emit("message-from",{input:g,id:d}),s([].concat(Object(l.a)(o),[{message:g,id:"You"}])),e.target.message.value="",E.current.focus()}},r.a.createElement("input",{ref:E,name:"message",placeholder:m.state?m.name:"message",onInput:function(){return p.emit("typing...")},onChange:function(e){g=e.target.value},type:"text"}),r.a.createElement("button",{type:"submit"},"Send"))))};a(169);function b(e){var t=e.message;return r.a.createElement("div",{className:"modal-wrap"},r.a.createElement("div",{className:"modal"},r.a.createElement("h2",null,t)))}var j,h,O,N,y={config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,setInterval(function(){p.a.get("https://rocky-reef-68087.herokuapp.com/email")},3e5);var k=[];function S(e){var t=Object(c.useState)({catchIt:!1,calling:!1,chatState:!1,peer:new f.a(y),localStream:null,peercall:null,rejected:!1}),a=Object(n.a)(t,2),o=a[0],m=a[1],d=Object(c.useState)([]),p=Object(n.a)(d,2),S=p[0],w=p[1],U=Object(c.useState)(),C=Object(n.a)(U,2),I=C[0],M=C[1],T=Object(c.useRef)(null),L=Object(c.useRef)(null),A=e.user.name,x=e.socket,R=Object(c.useState)({}),Y=Object(n.a)(R,2),D=Y[0],F=Y[1];function P(e){h=e.currentTarget.parentElement.parentElement.getAttribute("data-number");var t=o.peer.connect(h);t.on("open",function(){t.on("data",function(e){if("rejected"!==e){if(!navigator.getUserMedia)return O="You don't have web camera or you have http connection",m(function(e){return Object(i.a)({},e,{rejected:!0})}),void setTimeout(function(){m(function(e){return Object(i.a)({},e,{rejected:!1})})},5e3);navigator.getUserMedia({video:!0,audio:!1},function(e){var t=o.peer.call(h,e);t.on("stream",function(t){return _(t,e)}),t.on("close",function(t){e.getTracks().forEach(function(e){return e.stop()}),m(function(e){return Object(i.a)({},e,{calling:!1})})}),m(function(e){return Object(i.a)({},e,{calling:!0,peercall:t})})},J)}else"rejected"===e&&(O="Your call has been rejected",m(function(e){return Object(i.a)({},e,{rejected:!0})}),setTimeout(function(){m(function(e){return Object(i.a)({},e,{rejected:!1})})},5e3))}),t.send("request")})}function _(e,t){t.getAudioTracks().enabled=!1,T.current.srcObject=t,e!==j&&(w(function(t){return[].concat(Object(l.a)(t),[e])}),j=e)}function q(){o.peercall.send("rejected"),m(function(e){return Object(i.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function G(){o.peercall.send("accepted"),m(function(e){return Object(i.a)({},e,{calling:!1,catchIt:!1,peercall:null})})}function J(e){alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e))}return Object(c.useEffect)(function(){function e(e){N&&e.layerX>0&&N.add(e.layerX,e.layerY)}function t(a){N&&(N.simplify(),N.selected=!1),L.current.removeEventListener("mousemove",e),L.current.removeEventListener("mouseup",t)}o.peer.on("open",function(e){x.send(e)}),o.peer.on("connection",function(e){e.on("data",function(t){m(function(t){return Object(i.a)({},t,{catchIt:!0,peercall:e})})}),m(function(t){return Object(i.a)({},t,{peercall:e})})}),x.on("message",function(){var e=Object(u.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:delete t[A],F(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),o.peer.on("call",function(e){navigator.getUserMedia?navigator.getUserMedia({video:!0,audio:!1},function(t){e.answer(t),h=e.peer,e.on("close",function(e){t.getTracks().forEach(function(e){return e.stop()}),m(function(e){return Object(i.a)({},e,{calling:!1})})}),e.on("stream",function(e){return _(e,t)}),m(function(t){return Object(i.a)({},t,{catchIt:!1,calling:!0,peercall:e})})},J):e.close()}),v.a.setup(L.current),L.current.addEventListener("mousedown",function(a){N&&(N.selected=!1);console.log(k),2===a.button&&N&&k.forEach(function(e){return e.remove()});N=new g.Path({strokeColor:"#152238",selected:!0}),k.push(N),L.current.addEventListener("mousemove",e),L.current.addEventListener("mouseup",t)})},[]),Object(c.useEffect)(function(){m(I?function(e){return Object(i.a)({},e,{chatState:!0})}:function(e){return Object(i.a)({},e,{chatState:!1})})},[I]),r.a.createElement("div",{className:"App"},r.a.createElement("canvas",{id:"draw",ref:L}),o.rejected&&r.a.createElement(b,{message:O}),r.a.createElement("div",{className:"users-list ".concat(o.calling||o.chatState?"hidden":"")},r.a.createElement("ul",{onClick:function(e){if("UL"!==e.target.tagName&&"calling"!==e.target.className&&"I"!==e.target.tagName&&"calling pulse-button"!==e.target.className){for(var t=e.target;!t.getAttribute("data-name");)t=t.parentElement;var a={};a[t.getAttribute("data-name")]=t.getAttribute("data-number"),M(a)}}},r.a.createElement("li",{className:"header"},r.a.createElement("h1",null,"Users List"),r.a.createElement("i",{className:"far fa-comments chat-change",onClick:function(){return m(Object(i.a)({},o,{chatState:!0}))}})),Object.keys(D).map(function(e,t){return r.a.createElement("li",{"data-name":e,className:"".concat(I&&I[e]&&"active"),"data-number":D[e],key:t},r.a.createElement("div",{className:"user-name"},e.slice(0,2)),r.a.createElement("p",null,e),r.a.createElement("div",{className:"button"},r.a.createElement("div",{onClick:o.catchIt?G:P,className:"calling ".concat(o.catchIt&&o.peercall.peer===D[e]?"pulse-button":"")},r.a.createElement("i",{className:"fas fa-phone"})),o.catchIt&&o.peercall.peer===D[e]&&r.a.createElement("div",{onClick:q,className:"reject calling"},r.a.createElement("i",{className:"fas fa-phone-slash"}))))}))),o.calling&&r.a.createElement("div",{className:"video-chat ".concat(!o.calling&&"hidden")},r.a.createElement(function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"chat-section"},r.a.createElement("div",{className:"chat-wrap"},r.a.createElement("div",{className:"my_wrapp"},r.a.createElement("video",{muted:!0,className:"my",ref:T,autoPlay:!0})),r.a.createElement("div",{className:"chat"},S.map(function(e,t){return e.active?r.a.createElement("video",{className:"video",autoPlay:!0,key:t,ref:function(t){return t?t.srcObject=e:""}}):""})),r.a.createElement("div",{className:"button-section"},r.a.createElement("div",{onClick:function(){return o.peercall?o.peercall.close():o.peer.close()},className:"reject calling"},r.a.createElement("i",{className:"fas fa-phone-slash"})),r.a.createElement("i",{className:"fas fa-microphone"}),r.a.createElement("i",{className:"fas fa-volume-up"})))))},null)),!o.calling&&r.a.createElement(r.a.Fragment,null,r.a.createElement("i",{onClick:function(){return m(function(e){return Object(i.a)({},e,{chatState:!1})})},className:"fas fa-times close-button ".concat(o.chatState?"":"hidden")}),r.a.createElement("div",{className:"text-chat ".concat(!o.chatState&&"hidden")},r.a.createElement(E,{selectedUser:A,socket:x}))))}var w,U=a(170),C=a.n(U);a(202),a(203);function I(){return r.a.createElement("div",{className:"lds-dual-ring"})}function M(){var e=Object(c.useState)(!1),t=Object(n.a)(e,2),a=t[0],l=t[1],o=Object(c.useState)({}),s=Object(n.a)(o,2),u=s[0],i=s[1],m=Object(c.useState)(!0),f=Object(n.a)(m,2),d=f[0],p=f[1],g=Object(c.useState)(!0),v=Object(n.a)(g,2),E=v[0],b=v[1];return Object(c.useEffect)(function(){document.title="Chat",w.on("message",function(e){"err"===e.type?(l(!1),p(!1)):(b(!0),l(!0))})},[]),a?r.a.createElement(S,{socket:w,user:u}):r.a.createElement("div",{className:"login-wrap"},r.a.createElement("form",{className:"user-connection",onSubmit:function(e){b(!1),e.preventDefault(),i({name:e.target.name.value,room:e.target.room.value}),w.emit("join",e.target.room.value,e.target.name.value)}},!E&&r.a.createElement(I,null),r.a.createElement("h2",{className:"form-signin-heading"},"Please select room and enter your nickname"),r.a.createElement("select",{type:"",className:"form-control",name:"room",required:!0},r.a.createElement("option",null,"First room"),r.a.createElement("option",null,"Second room")),r.a.createElement("input",{type:"text",className:"form-control",name:"name",placeholder:"USER NAME",required:!0}),!d&&r.a.createElement("div",{className:"alert"},"User already in this room"),r.a.createElement("input",{className:"submitButton",type:"submit",value:"Enter"})))}a.d(t,"default",function(){return M}),w=C.a.connect("https://rocky-reef-68087.herokuapp.com")}}]);
//# sourceMappingURL=7.2b0f72a7.chunk.js.map